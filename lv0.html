<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://revenant-three.vercel.app/img/7427.png" type="image/png">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petualangan Pemikiran Komputasional</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 500px;
            animation: fadeInUp 0.8s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-card h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .login-card h2 {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .login-card p {
            color: #666;
            margin-bottom: 25px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-large {
            padding: 15px 40px !important;
            font-size: 1.2em !important;
            width: 100%;
        }

        .login-note {
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
        }

        .user-info {
            margin-top: 15px;
            color: white;
            font-size: 1.1em;
        }

        .progress-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .level-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .level-container:hover {
            transform: translateY(-5px);
        }

        .level-locked {
            opacity: 0.5;
            pointer-events: none;
            position: relative;
        }

        .level-locked::after {
            content: "üîí Level Terkunci";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            z-index: 10;
        }

        .level-completed {
            border: 3px solid #4CAF50;
            position: relative;
        }

        .level-completed::before {
            content: "‚úÖ Selesai";
            position: absolute;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 5;
        }

        .level-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .level-badge {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            margin-right: 20px;
        }

        .level-1 { background: linear-gradient(135deg, #4CAF50, #8BC34A); }
        .level-2 { background: linear-gradient(135deg, #2196F3, #03A9F4); }
        .level-3 { background: linear-gradient(135deg, #FF9800, #FFC107); }
        .level-4 { background: linear-gradient(135deg, #F44336, #E91E63); }
        .level-5 { background: linear-gradient(135deg, #9C27B0, #673AB7); }

        .level-info h2 {
            color: #333;
            margin-bottom: 5px;
        }

        .level-info p {
            color: #666;
            font-size: 0.9em;
        }

        .timer-display {
            background: #fff3cd;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
            margin: 10px 0;
            font-weight: bold;
            color: #856404;
        }

        .principle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .principle-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .principle-card:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .principle-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .principle-card p {
            color: #555;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .activity-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .activity-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .activity-section h3::before {
            content: "üéØ";
            margin-right: 10px;
            font-size: 1.3em;
        }

        .activity-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .activity-box strong {
            color: #667eea;
            display: block;
            margin-bottom: 8px;
        }

        .challenge-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            margin: 10px 0;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .reflection-box {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .reflection-box h3 {
            color: #5e35b1;
            margin-bottom: 15px;
        }

        .reflection-questions {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .reflection-questions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .reflection-questions li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .reflection-questions li::before {
            content: "üí≠";
            position: absolute;
            left: 0;
        }

        .certificate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .certificate h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .certificate-body {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .score-display {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        .grade-badge {
            display: inline-block;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 2em;
            font-weight: bold;
            margin: 20px 0;
        }

        .grade-a { background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; }
        .grade-b { background: linear-gradient(135deg, #2196F3, #03A9F4); color: white; }
        .grade-c { background: linear-gradient(135deg, #FF9800, #FFC107); color: white; }
        .grade-d { background: linear-gradient(135deg, #F44336, #E91E63); color: white; }

        .next-game-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }
            
            .principle-grid {
                grid-template-columns: 1fr;
            }

            .login-card {
                padding: 30px 20px;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- LOGIN SCREEN -->
        <div id="loginScreen" class="login-screen">
            <div class="login-card">
                <h1>üöÄ Selamat Datang!</h1>
                <h2>Petualangan Pemikiran Komputasional</h2>
                <p>Di sebuah dunia yang dipenuhi sihir kuno dan makhluk legendaris, Petualangan Pemikiran Komputasional menjadi perjalanan epik bagi para penjelajah. Dunia itu tidak hanya ditaklukkan dengan pedang atau mantra, tetapi dengan kemampuan berpikir logis, terstruktur, dan kreatif. Setiap hutan terkutuk menyimpan pola rahasia, setiap labirin kristal menuntut pemecahan masalah, dan setiap naga penjaga gerbang hanya bisa dikalahkan dengan strategi yang tepat.</p>
                <input type="text" id="userName" class="login-input" placeholder="Masukkan nama Anda" maxlength="50">
                <button class="btn btn-large" onclick="startLearning()">Mulai Petualangan üéØ</button>
                <p class="login-note">üí° Tip: Selesaikan dengan cepat untuk skor tinggi!</p>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div id="mainContent" style="display: none;">
            <header>
                <h1>üöÄ Petualangan Pemikiran Komputasional</h1>
                <p>Jelajahi Pemikiran Komputasional dengan Pendekatan Mendalam</p>
                <div class="user-info">
                    <span>üë§ <strong id="displayName"></strong></span>
                    <span style="margin-left: 20px;">‚è±Ô∏è Waktu: <strong id="totalTime">00:00</strong></span>
                </div>
            </header>

            <div class="progress-container">
                <h3 style="margin-bottom: 10px; color: #333;">Progres Pembelajaran Anda</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div style="margin-top: 10px; color: #666; font-size: 0.9em;">
                    Level Diselesaikan: <strong id="completedCount">0</strong> / 5
                </div>
            </div>

            <!-- Levels akan di-load secara dinamis di sini -->
            <div id="levelContainer"></div>

            <!-- Certificate -->
            <div class="certificate" id="certificateSection" style="display: none;">
                <h2>üéì SERTIFIKAT PENYELESAIAN üéì</h2>
                <div class="certificate-body">
                    <p style="font-size: 1.2em; margin-bottom: 20px;">Diberikan kepada:</p>
                    <h3 style="font-size: 2em; color: #667eea; margin-bottom: 30px;" id="certName"></h3>
                    
                    <p style="font-size: 1.1em; line-height: 1.8;">
                        Telah berhasil menyelesaikan <strong>Petualangan Pemikiran Komputasional</strong><br>
                        dengan menguasai Pilar Pemikiran Komputasional (Dekomposisi ‚Ä¢ Pengenalan Pola ‚Ä¢ Abstraksi ‚Ä¢ Algoritma) <br>
                        Petualangan ini bukan sekadar kisah fantasy, melainkan perjalanan transformasi di mana kecerdikan menjadi kekuatan terbesar, dan pikiran yang terlatih mampu mengubah kekacauan menjadi harmoni. Di dunia fantasi dan magis ini, berpikir adalah sihir tertinggi.
                    </p>

                    <div class="score-display" id="finalScore">0</div>
                    <div class="grade-badge" id="gradeBadge">A</div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; text-align: left;">
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 10px;">
                            <strong>üìä Detail Waktu:</strong><br>
                            <div id="timeBreakdown"></div>
                        </div>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 10px;">
                            <strong>‚≠ê Pencapaian:</strong><br>
                            <div id="achievements"></div>
                        </div>
                    </div>

                    <p style="color: #666; font-size: 0.9em; margin-top: 20px;">
                        Tanggal: <span id="completionDate"></span>
                    </p>
                </div>
                
                <button class="btn btn-large" onclick="downloadCertificate()" style="margin-top: 20px;">
                    üì• Download Sertifikat (Screenshot)
                </button>
                <button class="btn next-game-btn btn-large" onclick="goToNextGame()">
                    üéÆ Lanjut ke Game Berikutnya ‚Üí
                </button>
                <button class="btn" onclick="restartJourney()" style="margin-top: 10px; background: white; color: #667eea;">
                    üîÑ Mulai Ulang
                </button>
            </div>

        </div><!-- End Main Content -->
    </div><!-- End Container -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Level templates with random challenges
        const levelTemplates = {
            1: {
                title: "Level 1: Pengenalan Dasar (Pemula)",
                subtitle: "Memahami konsep dasar dengan analogi kehidupan sehari-hari",
                content: function() {
                    return `
                        <div class="principle-grid">
                            <div class="principle-card">
                                <h3>üß© Dekomposisi</h3>
                                <p><strong>Analogi:</strong> Seperti membuat nasi goreng - pecah menjadi langkah kecil: siapkan bahan, goreng bumbu, masukkan nasi, aduk, sajikan.</p>
                            </div>
                            <div class="principle-card">
                                <h3>üîç Pengenalan Pola</h3>
                                <p><strong>Analogi:</strong> Seperti mengenali pola pada batik - ada motif yang berulang dengan keteraturan tertentu.</p>
                            </div>
                            <div class="principle-card">
                                <h3>‚úÇÔ∏è Abstraksi</h3>
                                <p><strong>Analogi:</strong> Seperti peta jalan - hanya menampilkan info penting (jalan, nama kota), mengabaikan detail (warna rumah, jenis pohon).</p>
                            </div>
                            <div class="principle-card">
                                <h3>üìã Algoritma</h3>
                                <p><strong>Analogi:</strong> Seperti resep masakan - langkah demi langkah yang jelas dan berurutan untuk mencapai hasil.</p>
                            </div>
                        </div>

                        <div class="activity-section">
                            <h3>Aktivitas Bermakna</h3>
                            <div class="activity-box">
                                <strong>Tantangan: Membuat ${currentLevel1Challenge.task}</strong>
                                <p>${currentLevel1Challenge.instruction}</p>
                                <textarea class="challenge-input" id="level1-input" rows="6" placeholder="Contoh:
1. Siapkan...
2. ...
3. ..."></textarea>
                                <button class="btn" onclick="checkLevel1()">Periksa Jawaban</button>
                                <div class="feedback" id="level1-feedback"></div>
                            </div>
                        </div>

                        <div class="reflection-box">
                            <h3>ü§î Refleksi Berkesadaran</h3>
                            <div class="reflection-questions">
                                <ul>
                                    <li>Bagaimana rasanya ketika masalah besar dipecah menjadi bagian kecil?</li>
                                    <li>Pola apa yang sering kamu temui dalam kehidupan sehari-hari?</li>
                                    <li>Mengapa urutan langkah penting dalam menyelesaikan masalah?</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
            },
            2: {
                title: "Level 2: Penerapan Konsep (Dasar)",
                subtitle: "Mengaplikasikan prinsip pada masalah sederhana",
                content: function() {
                    return `
                        <div class="principle-grid">
                            <div class="principle-card">
                                <h3>üß© Dekomposisi</h3>
                                <p><strong>Praktik:</strong> Merencanakan acara ulang tahun - pecah menjadi: daftar tamu, lokasi, dekorasi, makanan, hiburan, undangan.</p>
                            </div>
                            <div class="principle-card">
                                <h3>üîç Pengenalan Pola</h3>
                                <p><strong>Praktik:</strong> Mencari pola dalam deret angka atau hari dalam seminggu yang berulang.</p>
                            </div>
                            <div class="principle-card">
                                <h3>‚úÇÔ∏è Abstraksi</h3>
                                <p><strong>Praktik:</strong> Membuat diagram alur sederhana - fokus pada langkah utama, abaikan detail kecil yang tidak relevan.</p>
                            </div>
                            <div class="principle-card">
                                <h3>üìã Algoritma</h3>
                                <p><strong>Praktik:</strong> Membuat prosedur mencari buku di perpustakaan menggunakan sistem katalog.</p>
                            </div>
                        </div>

                        <div class="activity-section">
                            <h3>Aktivitas Interaktif</h3>
                            <div class="activity-box">
                                <strong>Tantangan: Tebak Pola Angka</strong>
                                <p id="patternChallenge">Lengkapi deret: ${currentPattern.sequence.join(', ')}, ?, ?, ?</p>
                                <input type="number" class="challenge-input" id="level2-input1" placeholder="Angka ke-1">
                                <input type="number" class="challenge-input" id="level2-input2" placeholder="Angka ke-2">
                                <input type="number" class="challenge-input" id="level2-input3" placeholder="Angka ke-3">
                                <button class="btn" onclick="checkLevel2Pattern()">Periksa Jawaban</button>
                                <div class="feedback" id="level2-feedback"></div>
                            </div>

                            <div class="activity-box">
                                <strong>Dekomposisi Masalah</strong>
                                <p>Pecahkan masalah "${currentLevel2Decompose.task}" menjadi minimal 5 sub-tugas:</p>
                                <textarea class="challenge-input" id="level2-decompose" rows="6" placeholder="1. ...
2. ...
3. ..."></textarea>
                                <button class="btn" onclick="checkLevel2Decompose()">Periksa Jawaban</button>
                                <div class="feedback" id="decompose-feedback"></div>
                            </div>
                        </div>
                    `;
                }
            }
            // Level 3, 4, 5 akan ditambahkan...
        };

        // Random challenges database
        const level1Challenges = [
            { task: "Teh Manis", instruction: "Tuliskan langkah-langkah membuat teh manis dengan urutan yang benar!", minSteps: 5 },
            { task: "Kopi", instruction: "Tuliskan langkah-langkah membuat kopi dengan urutan yang benar!", minSteps: 5 },
            { task: "Mie Instan", instruction: "Tuliskan langkah-langkah membuat mie instan dengan urutan yang benar!", minSteps: 5 },
            { task: "Sandwich", instruction: "Tuliskan langkah-langkah membuat sandwich dengan urutan yang benar!", minSteps: 5 }
        ];

        const patternChallenges = [
            { sequence: [2, 4, 6, 8], answers: [10, 12, 14], step: 2, name: '+2' },
            { sequence: [5, 10, 15, 20], answers: [25, 30, 35], step: 5, name: '+5' },
            { sequence: [3, 6, 9, 12], answers: [15, 18, 21], step: 3, name: '+3' },
            { sequence: [10, 20, 30, 40], answers: [50, 60, 70], step: 10, name: '+10' },
            { sequence: [1, 3, 5, 7], answers: [9, 11, 13], step: 2, name: '+2' },
            { sequence: [4, 8, 12, 16], answers: [20, 24, 28], step: 4, name: '+4' }
        ];

        const level2DecomposeTasks = [
            { task: "Membersihkan kamar", minSteps: 5 },
            { task: "Menyiapkan tas sekolah", minSteps: 5 },
            { task: "Memasak nasi goreng", minSteps: 5 },
            { task: "Mencuci sepeda", minSteps: 5 },
            { task: "Mengerjakan PR matematika", minSteps: 5 }
        ];

        // Game state
        let userName = '';
        let completedLevels = 0;
        const totalLevels = 5;
        let levelTimes = [0, 0, 0, 0, 0];
        let currentLevelStartTime = null;
        let totalStartTime = null;
        let timerInterval = null;
        let levelTimers = {};
        let currentLevel1Challenge = null;
        let currentPattern = null;
        let currentLevel2Decompose = null;

        // Level completion flags
        let level1Completed = false;
        let level2PatternCompleted = false;
        let level2DecomposeCompleted = false;

        const idealTimes = [180, 300, 480, 600, 900]; // 3, 5, 8, 10, 15 menit

        // Initialize game
        function initializeGame() {
            randomizeChallenges();
        }

        function randomizeChallenges() {
            currentLevel1Challenge = level1Challenges[Math.floor(Math.random() * level1Challenges.length)];
            currentPattern = patternChallenges[Math.floor(Math.random() * patternChallenges.length)];
            currentLevel2Decompose = level2DecomposeTasks[Math.floor(Math.random() * level2DecomposeTasks.length)];
        }

        function startLearning() {
            const nameInput = document.getElementById('userName').value.trim();
            if (nameInput === '') {
                alert('‚ö†Ô∏è Silakan masukkan nama Anda terlebih dahulu!');
                return;
            }
            
            userName = nameInput;
            document.getElementById('displayName').textContent = userName;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            initializeGame();
            totalStartTime = Date.now();
            startTotalTimer();
            
            renderCurrentLevel();
            startLevelTimer(1);
        }

        function renderCurrentLevel() {
            const currentLevelNum = completedLevels + 1;
            if (currentLevelNum > totalLevels) return;

            const container = document.getElementById('levelContainer');
            const template = levelTemplates[currentLevelNum];
            
            if (template) {
                container.innerHTML = `
                    <div class="level-container" data-level="${currentLevelNum}">
                        <div class="timer-display">‚è±Ô∏è Waktu Level Ini: <span id="level${currentLevelNum}Timer">00:00</span></div>
                        <div class="level-header">
                            <div class="level-badge level-${currentLevelNum}">${currentLevelNum}</div>
                            <div class="level-info">
                                <h2>${template.title}</h2>
                                <p>${template.subtitle}</p>
                            </div>
                        </div>
                        ${template.content()}
                    </div>
                `;
            } else {
                // Simplified levels 3-5
                renderSimplifiedLevel(currentLevelNum, container);
            }
        }

        function renderSimplifiedLevel(levelNum, container) {
            const challenges = {
                3: { title: "Integrasi Konsep", task: "Analisis studi kasus perpustakaan menggunakan 4 prinsip", minWords: 100 },
                4: { title: "Optimisasi", task: "Optimalkan sistem pengiriman paket", minWords: 120 },
                5: { title: "Kreasi & Inovasi", task: "Rancang sistem smart city untuk manajemen sampah", minWords: 150 }
            };

            const challenge = challenges[levelNum];
            container.innerHTML = `
                <div class="level-container" data-level="${levelNum}">
                    <div class="timer-display">‚è±Ô∏è Waktu Level Ini: <span id="level${levelNum}Timer">00:00</span></div>
                    <div class="level-header">
                        <div class="level-badge level-${levelNum}">${levelNum}</div>
                        <div class="level-info">
                            <h2>Level ${levelNum}: ${challenge.title}</h2>
                            <p>Tantangan tingkat lanjut</p>
                        </div>
                    </div>
                    <div class="activity-section">
                        <h3>Tantangan Utama</h3>
                        <div class="activity-box">
                            <strong>${challenge.task}</strong>
                            <p>Jelaskan solusi Anda menggunakan keempat prinsip pemikiran komputasional (minimal ${challenge.minWords} kata).</p>
                            <textarea class="challenge-input" id="level${levelNum}-input" rows="10" placeholder="Tuliskan analisis lengkap Anda..."></textarea>
                            <button class="btn" onclick="checkLevel${levelNum}()">Periksa Jawaban</button>
                            <div class="feedback" id="level${levelNum}-feedback"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Timer functions
        function startTotalTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - totalStartTime) / 1000);
                document.getElementById('totalTime').textContent = formatTime(elapsed);
            }, 1000);
        }

        function startLevelTimer(level) {
            currentLevelStartTime = Date.now();
            
            if (levelTimers[level]) {
                clearInterval(levelTimers[level]);
            }
            
            levelTimers[level] = setInterval(() => {
                const elapsed = Math.floor((Date.now() - currentLevelStartTime) / 1000);
                const timerElement = document.getElementById(`level${level}Timer`);
                if (timerElement) {
                    timerElement.textContent = formatTime(elapsed);
                }
            }, 1000);
        }

        function stopLevelTimer(level) {
            if (levelTimers[level]) {
                clearInterval(levelTimers[level]);
            }
            
            const elapsed = Math.floor((Date.now() - currentLevelStartTime) / 1000);
            levelTimes[level - 1] = elapsed;
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Level 1 validation
        function checkLevel1() {
            const answer = document.getElementById('level1-input').value.trim();
            const lines = answer.split('\n').filter(line => line.trim().length > 0);
            
            if (lines.length >= currentLevel1Challenge.minSteps && answer.length > 60) {
                level1Completed = true;
                showFeedback('level1-feedback', 
                    '‚úÖ <strong>Sempurna!</strong><br>' +
                    'Kamu telah menerapkan <strong>Dekomposisi</strong> dan <strong>Algoritma</strong> dengan baik!<br><br>' +
                    '<button class="btn" onclick="completeLevel(1)" style="margin-top: 15px;">Lanjut ke Level 2 ‚Üí</button>',
                    'success');
            } else {
                showFeedback('level1-feedback', 
                    `‚ùå <strong>Belum cukup lengkap!</strong><br>` +
                    `Jawaban perlu minimal ${currentLevel1Challenge.minSteps} langkah yang detail.<br>` +
                    `Coba lagi!`,
                    'info');
            }
        }

        // Level 2 validation
        function checkLevel2Pattern() {
            const ans1 = parseInt(document.getElementById('level2-input1').value);
            const ans2 = parseInt(document.getElementById('level2-input2').value);
            const ans3 = parseInt(document.getElementById('level2-input3').value);
            
            if (ans1 === currentPattern.answers[0] && 
                ans2 === currentPattern.answers[1] && 
                ans3 === currentPattern.answers[2]) {
                level2PatternCompleted = true;
                showFeedback('level2-feedback',
                    `üéØ <strong>Benar!</strong> Pola: ${currentPattern.name}<br>` +
                    `Sekarang selesaikan tantangan Dekomposisi!`,
                    'success');
                checkLevel2Complete();
            } else {
                showFeedback('level2-feedback',
                    `‚ùå <strong>Belum tepat!</strong> Coba perhatikan pola lagi.`,
                    'info');
            }
        }

        function checkLevel2Decompose() {
            const answer = document.getElementById('level2-decompose').value.trim();
            const lines = answer.split('\n').filter(line => line.trim().length > 0);
            
            if (lines.length >= currentLevel2Decompose.minSteps && answer.length > 80) {
                level2DecomposeCompleted = true;
                showFeedback('decompose-feedback',
                    '‚úÖ <strong>Bagus!</strong> Dekomposisi yang baik!',
                    'success');
                checkLevel2Complete();
            } else {
                showFeedback('decompose-feedback',
                    `‚ùå Minimal ${currentLevel2Decompose.minSteps} sub-tugas yang detail!`,
                    'info');
            }
        }

        function checkLevel2Complete() {
            if (level2PatternCompleted && level2DecomposeCompleted) {
                const feedback = document.getElementById('decompose-feedback');
                const currentHTML = feedback.innerHTML;
                feedback.innerHTML = currentHTML + 
                    '<br><button class="btn" onclick="completeLevel(2)" style="margin-top: 15px;">Lanjut ke Level 3 ‚Üí</button>';
            }
        }

        // Levels 3-5 validation
        function checkLevel3() {
            validateAdvancedLevel(3, 100);
        }

        function checkLevel4() {
            validateAdvancedLevel(4, 120);
        }

        function checkLevel5() {
            validateAdvancedLevel(5, 150);
        }

        function validateAdvancedLevel(level, minWords) {
            const answer = document.getElementById(`level${level}-input`).value.trim();
            const wordCount = answer.split(/\s+/).filter(w => w.length > 0).length;
            
            const hasDekomposisi = /dekomposisi|decompose|pecah|bagian|sub/i.test(answer);
            const hasPola = /pola|pattern|keteraturan/i.test(answer);
            const hasAbstraksi = /abstraksi|abstract|data|informasi/i.test(answer);
            const hasAlgoritma = /algoritma|algorithm|prosedur|langkah/i.test(answer);

            if (wordCount < minWords) {
                showFeedback(`level${level}-feedback`,
                    `‚ùå Jawaban terlalu singkat! Saat ini: ${wordCount} kata (minimal ${minWords} kata)`,
                    'info');
                return;
            }

            if (!hasDekomposisi || !hasPola || !hasAbstraksi || !hasAlgoritma) {
                showFeedback(`level${level}-feedback`,
                    `‚ùå Pastikan mencakup semua prinsip:<br>` +
                    `${hasDekomposisi ? '‚úÖ' : '‚ùå'} Dekomposisi<br>` +
                    `${hasPola ? '‚úÖ' : '‚ùå'} Pola<br>` +
                    `${hasAbstraksi ? '‚úÖ' : '‚ùå'} Abstraksi<br>` +
                    `${hasAlgoritma ? '‚úÖ' : '‚ùå'} Algoritma`,
                    'info');
                return;
            }

            showFeedback(`level${level}-feedback`,
                '‚úÖ <strong>Luar biasa!</strong> Analisis yang sangat baik!<br><br>' +
                `<button class="btn" onclick="completeLevel(${level})">Lanjut ${level === 5 ? 'ke Hasil' : 'ke Level ' + (level + 1)} ‚Üí</button>`,
                'success');
        }

        function completeLevel(level) {
            stopLevelTimer(level);
            completedLevels++;
            updateProgress();
            
            if (completedLevels < totalLevels) {
                // Randomize challenges for next level
                randomizeChallenges();
                
                setTimeout(() => {
                    renderCurrentLevel();
                    startLevelTimer(completedLevels + 1);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 1000);
            } else {
                clearInterval(timerInterval);
                setTimeout(() => {
                    showCertificate();
                }, 1000);
            }
        }

        function updateProgress() {
            const percentage = (completedLevels / totalLevels) * 100;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressFill').textContent = Math.round(percentage) + '%';
            document.getElementById('completedCount').textContent = completedLevels;
        }

        function showFeedback(elementId, message, type = 'success') {
            const feedback = document.getElementById(elementId);
            if (feedback) {
                feedback.className = 'feedback ' + type;
                feedback.innerHTML = message;
                feedback.style.display = 'block';
                feedback.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Scoring and certificate
        function calculateScore() {
            let totalScore = 0;
            let scoreDetails = [];
            
            levelTimes.forEach((time, index) => {
                const ideal = idealTimes[index];
                let levelScore = 0;
                let performance = '';
                
                if (time <= ideal) {
                    levelScore = 100;
                    performance = 'Sangat Cepat! üöÄ';
                } else if (time <= ideal * 1.5) {
                    levelScore = 85;
                    performance = 'Cepat! ‚ö°';
                } else if (time <= ideal * 2) {
                    levelScore = 70;
                    performance = 'Baik üëç';
                } else if (time <= ideal * 3) {
                    levelScore = 60;
                    performance = 'Cukup üëå';
                } else {
                    levelScore = 50;
                    performance = 'Perlu Latihan üí™';
                }
                
                totalScore += levelScore;
                scoreDetails.push({
                    level: index + 1,
                    score: levelScore,
                    time: time,
                    performance: performance
                });
            });
            
            const avgScore = Math.round(totalScore / totalLevels);
            return { avgScore, scoreDetails };
        }

        function getGrade(score) {
            if (score >= 90) return { grade: 'A', class: 'grade-a', title: 'Luar Biasa!' };
            if (score >= 75) return { grade: 'B', class: 'grade-b', title: 'Sangat Baik!' };
            if (score >= 60) return { grade: 'C', class: 'grade-c', title: 'Baik!' };
            return { grade: 'D', class: 'grade-d', title: 'Perlu Peningkatan!' };
        }

        function showCertificate() {
            const { avgScore, scoreDetails } = calculateScore();
            const gradeInfo = getGrade(avgScore);
            const totalElapsed = levelTimes.reduce((a, b) => a + b, 0);
            
            document.getElementById('certName').textContent = userName;
            document.getElementById('finalScore').textContent = avgScore;
            document.getElementById('gradeBadge').textContent = `${gradeInfo.grade} - ${gradeInfo.title}`;
            document.getElementById('gradeBadge').className = `grade-badge ${gradeInfo.class}`;
            
            let timeBreakdownHTML = '';
            scoreDetails.forEach(detail => {
                timeBreakdownHTML += `Level ${detail.level}: ${formatTime(detail.time)} (${detail.score}) ${detail.performance}<br>`;
            });
            timeBreakdownHTML += `<strong>Total: ${formatTime(totalElapsed)}</strong>`;
            document.getElementById('timeBreakdown').innerHTML = timeBreakdownHTML;
            
            const fastLevels = scoreDetails.filter(d => d.score === 100).length;
            let achievementsHTML = `‚ö° ${fastLevels} Level Super Cepat<br>`;
            achievementsHTML += `‚úÖ ${totalLevels} Level Diselesaikan<br>`;
            if (avgScore >= 90) achievementsHTML += `üèÜ Master Pemikiran Komputasional<br>`;
            else if (avgScore >= 75) achievementsHTML += `ü•à Ahli Pemikiran Komputasional<br>`;
            achievementsHTML += `üìö 4 Pilar Dikuasai`;
            document.getElementById('achievements').innerHTML = achievementsHTML;
            
            const now = new Date();
            document.getElementById('completionDate').textContent = now.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            document.getElementById('levelContainer').style.display = 'none';
            document.getElementById('certificateSection').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function downloadCertificate() {
            alert('üì∏ Untuk menyimpan sertifikat:\n\n1. Screenshot area sertifikat\n2. Atau gunakan Snipping Tool\n3. Simpan gambar\n\nüí° Zoom out browser agar seluruh sertifikat terlihat!');
        }

        function goToNextGame() {
            const nextGameURL = prompt('Masukkan URL game berikutnya:', 'https://questmantra.vercel.app/');
            if (nextGameURL && nextGameURL.trim()) {
                window.location.href = nextGameURL;
            }
        }

        function restartJourney() {
            if (confirm('Yakin ingin mulai ulang? Progress akan hilang.')) {
                location.reload();
            }
        }
    </script>
</body>
</html>
